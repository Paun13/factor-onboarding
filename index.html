<!doctype html>
<html lang="bg">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light" />
    <meta name="theme-color" content="#fff1e6" />
    <title>FACTOR.BG – Принтер помощник</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root { color-scheme: light; }

      :root {
        --bg: #fff1e6;
        --card: #ffffff;
        --text: #111111;
        --muted: rgba(17, 17, 17, 0.7);
        --line: rgba(17, 17, 17, 0.14);
        --orange: #ff8a00;

        --radius-lg: 18px;
        --radius-md: 14px;

        --maxw: 420px;
        --navh: 92px;
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; }

      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: "Roboto", system-ui, -apple-system, "Segoe UI", sans-serif;
        overflow-x: hidden;
      }

      a { color: var(--orange); text-decoration: underline; }
      a:visited { color: var(--orange); }

      .app {
        max-width: var(--maxw);
        min-height: 100vh;
        margin: 0 auto;
        padding: 24px;
        padding-bottom: calc(24px + var(--navh) + env(safe-area-inset-bottom));
      }

      .top-space { margin-top: 80px; }
      .center { text-align: center; }

      .logo { height: 40px; }

      .subtitle {
        font-size: 20px;
        line-height: 1.35;
        margin-top: 48px;
      }

      .muted {
        color: var(--muted);
        font-size: 13px;
        line-height: 1.4;
      }

      .btn {
        width: 100%;
        height: 56px;
        border-radius: var(--radius-md);
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        border: 2px solid transparent;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        user-select: none;
      }
      .btn-primary { background: var(--orange); color: #fff; }
      .btn-secondary { background: transparent; color: var(--text); border-color: var(--orange); }
      .btn:disabled { opacity: 0.5; cursor: not-allowed; }

      .step-title {
        font-size: 28px;
        font-weight: 700;
        margin: 24px 0 10px;
      }

      .progress-row {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 8px;
      }

      .bar {
        height: 6px;
        background: rgba(17, 17, 17, 0.15);
        border-radius: 999px;
        overflow: hidden;
        margin-bottom: 12px;
      }
      .bar > div { height: 100%; background: var(--orange); }

      .card {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: var(--radius-lg);
        padding: 14px;
        margin-top: 14px;
      }

      .card-img {
        width: 100%;
        border-radius: 12px;
        display: block;
        border: 1px solid rgba(0, 0, 0, 0.08);
        background: #f2f2f2;
      }

      .divider {
        height: 1px;
        background: rgba(17, 17, 17, 0.12);
        margin: 14px 0;
      }

      .checklist { display: flex; flex-direction: column; gap: 12px; }

      .check {
        display: flex;
        gap: 12px;
        font-size: 15px;
        line-height: 1.35;
        align-items: flex-start;
      }

      .check input {
        width: 20px;
        height: 20px;
        accent-color: var(--orange);
        margin-top: 2px;
        flex: 0 0 auto;
      }

      .note {
        display: flex;
        gap: 10px;
        padding: 12px;
        border-radius: 14px;
        background: #ffe8cf;
        border: 1px solid rgba(255, 138, 0, 0.22);
        margin-top: 12px;
      }

      .note-icon { width: 22px; height: 22px; flex: 0 0 auto; }
      .note-text { font-size: 14px; line-height: 1.35; }

      .list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 24px;
      }

      .resource-btn {
        height: auto;
        padding: 16px 14px;
        border-radius: 14px;
        text-align: left;
        justify-content: flex-start;
        line-height: 1.25;
      }

      .video {
        width: 100%;
        border-radius: 12px;
        border: 1px solid rgba(0, 0, 0, 0.08);
        background: #f2f2f2;
        overflow: hidden;
      }

      .video-placeholder {
        padding: 48px 12px;
        text-align: center;
        color: rgba(0,0,0,0.55);
        font-weight: 600;
      }

      .nav {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--bg);
        border-top: 1px solid rgba(17, 17, 17, 0.1);
        padding: 12px 0 calc(12px + env(safe-area-inset-bottom));
      }

      .nav-inner {
        max-width: var(--maxw);
        margin: 0 auto;
        padding: 0 24px;
        display: flex;
        gap: 12px;
      }

      .page { display: none; }
      .page.active { display: block; }

      @media (max-width: 360px) {
        .app {
          padding: 16px;
          padding-bottom: calc(16px + var(--navh) + env(safe-area-inset-bottom));
        }
        .step-title { font-size: 24px; }
      }
    </style>
  </head>

  <body>
    <main class="app">
      <!-- WELCOME -->
      <section id="page-welcome" class="page active">
        <div class="center top-space">
          <img src="logo.png" class="logo" alt="FACTOR.BG" />
        </div>

        <p class="subtitle center">
          Поздравления!<br />
          Вие сте горд собственик на<br />
          принтер EPSON.
        </p>

        <div style="margin-top: 64px">
          <button class="btn btn-primary" onclick="go('intro')">→ Next</button>
        </div>
      </section>

      <!-- INTRO -->
      <section id="page-intro" class="page">
        <div class="center top-space">
          <img src="logo.png" class="logo" alt="FACTOR.BG" />
        </div>

        <p class="subtitle center">
          Нека ви помогнем с въвеждането<br />
          и стартирането на вашия принтер,<br />
          за да започнете работа<br />
          безпроблемно!
        </p>

        <div style="margin-top: 64px">
          <button class="btn btn-primary" onclick="goStep(1)">→ Да започваме!</button>

          <div style="margin-top: 32px;">
            <p class="muted center" style="margin: 0 0 16px 0;">
              Ако принтерът ви е вече инсталиран и готов за печат, може да прескочите към
              допълнителните ресурси.
            </p>
            <button class="btn btn-secondary" onclick="go('resources')">→ Към ресурси</button>
          </div>
        </div>
      </section>

      <!-- RESOURCES MENU -->
      <section id="page-resources" class="page">
        <div class="center top-space">
          <img src="logo.png" class="logo" alt="FACTOR.BG" />
        </div>

        <p class="subtitle" style="margin-top: 24px; text-align: left;">
          Честито, Вие завършихте началната инсталация на Вашият принтер.
          <br /><br />
          По-долу може да разгледате често задавани въпроси и инструкции.
        </p>

        <div class="list">
          <button class="btn btn-primary resource-btn" onclick="goArticle('warranty')">Удължена гаранция</button>
          <button class="btn btn-primary resource-btn" onclick="goArticle('nozzle')">Nozzle Check – Проверка на дюзи</button>
          <button class="btn btn-primary resource-btn" onclick="goArticle('headclean')">Почистване на печатащата глава</button>
          <button class="btn btn-primary resource-btn" onclick="goArticle('paperload')">Правилно поставяне на хартията при печат</button>
          <button class="btn btn-primary resource-btn" onclick="goArticle('maintank')">Подмяна на Maintenance Tank (контейнер за отпадъчно мастило)</button>
          <button class="btn btn-primary resource-btn" onclick="goArticle('paperjam')">Paper Jam грешка и почистване на колелцата за подаване на хартията</button>

          <button class="btn btn-primary resource-btn" onclick="goArticle('apple')">Проблем при принтиране на Apple устройства</button>
          <button class="btn btn-primary resource-btn" onclick="goArticle('storage')">Правилно съхранение и подготовка на печатната медия</button>
          <button class="btn btn-primary resource-btn" onclick="goArticle('printing')">Правила при печат, спецификации за матови медии и други</button>
        </div>

        <div class="card" style="margin-top: 18px;">
          <p style="margin: 0; line-height: 1.4;">
            Ако имате допълнителни въпроси за Вашият принтер, на които не може да намерите отговорът тук,
            свържете се с екипа на FACTOR.BG. Може да намерите контакти на нашият уебсайт.
          </p>
        </div>

        <div style="margin-top: 20px;">
          <button class="btn btn-secondary" onclick="goStep(11)">← Обратно към инсталацията</button>
        </div>
      </section>

      <!-- STEP PAGE -->
      <section id="page-step" class="page">
        <div id="step-root"></div>
      </section>

      <!-- ARTICLE PAGE -->
      <section id="page-article" class="page">
        <div id="article-root"></div>

        <div style="margin-top: 24px;">
          <button class="btn btn-secondary" onclick="go('resources')">← Назад</button>
        </div>
      </section>
    </main>

    <!-- Sticky nav for steps -->
    <div id="nav" class="nav" style="display: none;">
      <div class="nav-inner">
        <button class="btn btn-secondary" onclick="prevStep()">← Назад</button>
        <button id="nextBtn" class="btn btn-primary" onclick="nextStep()">→ Следваща стъпка</button>
      </div>
    </div>

    <script>
      // ---------- STEPS ----------
      // Your installation images:
      // - step 3 uses: step-3.png + step-4.png
      // - step 5 uses: step-6.png + step-7.png
      // - step 11 has no image (drivers/links card)
      const steps = [
        {
          n: 1,
          title: "Разопаковане на принтера",
          imgs: ["step-1.png"],
          checks: [
            "Премахнете транспортните ленти от външната част на принтера.",
            "Премахнете пластмасовите държачи, намиращи се в предната тава за хартия на принтера."
          ],
          warning: null,
          tip: "Съвет: запазете кашона на принтера, за да има безопасно място, в което да го транспортирате, ако се наложи."
        },
        {
          n: 2,
          title: "Разопаковане на принтера",
          imgs: ["step-2.png"],
          checks: [
            "Повдигнете горния капак и внимателно отлепете транспортната лента от печатащата глава.",
            "Премахнете пластмасовите държачи, намиращи се в предната тава за хартия на принтера."
          ],
          warning: "Внимание: не докосвайте енкодерната лента, за да не оставите отпечатъци по нея.",
          tip: null
        },
        {
          n: 3,
          title: "Включване на принтера",
          imgs: ["step-3.png", "step-4.png"],
          checks: [
            "Включете захранващият кабел в принтера и след това в захранването."
          ],
          warning: "Внимание: не свързвайте принтера с компютър все още.",
          tip: null
        },
        {
          n: 4,
          title: "Включване на принтера",
          imgs: ["step-5.png"],
          checks: [
            "Включете принтера от бутона.",
            "Изберете език."
          ],
          warning: "Внимание: Не стартирайте процедура по зареждане преди да сте налели мастило в принтера в следващите стъпки.",
          tip: "Съвет: Принтерът ще ви проведе по стъпка как да проведете първоначално зареждане на самият дисплей."
        },
        {
          n: 5,
          title: "Зареждане на мастило",
          imgs: ["step-6.png", "step-7.png"],
          checks: [
            "Повдигнете капака на принтера и след това на мастилницата.",
            "Уверете се, че цветът на резервоара за мастило съвпада с цвета на мастилото, което искате да заредите."
          ],
          warning: "Внимание: Уверете се, че цветът на резервоара за мастило съвпада с цвета на мастилото.",
          tip: "Съвет: запазете кашона на принтера, за да има безопасно място, в което да го транспортирате, ако се наложи."
        },
        {
          n: 6,
          title: "Зареждане на мастило",
          imgs: ["step-8.png"],
          checks: [
            "Отстранете капачката, докато държите бутилката с мастило изправена, за да не протече.",
            "Уверете се, че цветът на резервоара съвпада с цвета на мастилото."
          ],
          warning: "Внимание: Използвайте мастилата, предоставени с вашият продукт. Използване на неоригинални мастила може да доведе до отпадане на гаранцията.",
          tip: "Съвет: запазете кашона на принтера, за да има безопасно място, в което да го транспортирате, ако се наложи."
        },
        {
          n: 7,
          title: "Зареждане на мастило",
          imgs: ["step-9.png"],
          checks: [
            "Поставете бутилката с мастило за порта за пълнене на мастилото.",
            "Мастилото спира автоматично да се пълни като достигне горната граница, след което спокойно може да отстраните бутилката."
          ],
          warning: "Внимание: Не стискайте бутилките с мастило и не ги удряйте.",
          tip: "Съвет: Ако мастилото не започне да се пълни в резервоара, отстранете бутилката и я поставете отново."
        },
        {
          n: 8,
          title: "Зареждане на мастило",
          imgs: ["step-10.png"],
          checks: [
            "Затворете мастилниците след пълнене. Ще чуете “щрак”, когато са затворени правилно."
          ],
          warning: null,
          tip: "Съвет: Ако мастилото не започне да се пълни в резервоара, отстранете бутилката и я поставете отново."
        },
        {
          n: 9,
          title: "Зареждане на мастило",
          imgs: ["step-11.png"],
          checks: [
            "След пълнене на мастилото задръжте бутона “OK” за 5 секунди.",
            "Следвайте инструкциите на дисплея, след което натиснете “Start”, за да започне зареждането на мастило. (Отнема около 7 минути)"
          ],
          warning: "Внимание: Не изключвайте принтера от захранването или от контакта по време на зареждане.",
          tip: "Съвет: Натиснете бутона за следваща страница на дисплея, докато не излезе бутонът “OK”, ако сте пропуснали да го следвате."
        },
        {
          n: 10,
          title: "Калибрация на принтера",
          imgs: ["step-12.png"],
          checks: [
            "След зареждане на мастилото се извежда екранът за регулиране на печат.",
            "Следвайте инструкциите на дисплея и заредете обикновена хартия A4 в най-долната тава, както е показано."
          ],
          warning: "Внимание: Обърнете внимание на ограничителите за хартия. Те трябва да допират до хартията, за да може тя да върви правилно.",
          tip: null
        },
        {
          n: 11,
          title: "Инсталация на драйвери",
          checks: [],
          warning: null,
          tip: null,
          customHtml: `
            <div class="card">
              <p style="margin:0; line-height:1.45;">
                Ако печатате от компютър, посетете сайта на EPSON, за да свалите драйверите за Вашият принтер
                или използвайте CD-то, предоставено с принтера. Когато приключите, принтера ще е готов за употреба.
              </p>
              <p style="margin:12px 0 0 0;">
                <a href="https://www.epson.eu/" target="_blank" rel="noreferrer">www.epson.eu</a>
              </p>
              <div class="divider"></div>
              <p style="margin:0; line-height:1.45;">
                Ако печатате през телефона, може да използвате приложението на EPSON:
                <a href="https://play.google.com/store/apps/details?id=com.epson.epsonsmart&hl=bg" target="_blank" rel="noreferrer">Epson Smart Panel</a>
              </p>
              <div class="divider"></div>
              <button class="btn btn-primary" onclick="go('resources')">→ Приключи</button>
            </div>
          `
        }
      ];

      // ---------- RESOURCES ----------
      // Filenames: spaces -> dashes, lowercase
      const resources = {
        warranty: {
          title: "Регистриране за удължена гаранция",
          html: `
            <div class="card">
              <p style="margin:0; line-height:1.45;">
                Може да се регистрирате за удължена гаранция на вашият принтер в срок от 30 дни от датата на закупуване.
              </p>

              <p style="margin:14px 0 0 0;">
                <a href="https://epson.eu/en_EU/promotions/extended-warranty?sid=k56nebob84bbeimnin3sn8br946" target="_blank" rel="noreferrer">
                  Epson Extended Warranty
                </a>
              </p>

              <p style="margin:14px 0 0 0; line-height:1.45;">
                Може да проверите за вече активирана удължена гаранция (обработката може да отнеме до 30 дни).
              </p>

              <p style="margin:14px 0 0 0;">
                <a href="https://warrantycheck.epson.eu/" target="_blank" rel="noreferrer">
                  Epson Warranty Checker
                </a>
              </p>
            </div>
          `
        },

        nozzle: {
          title: "Nozzle Check – Проверка на дюзи",
          html: `
            <div class="card">
              <p style="margin:0; line-height:1.45;">
                Ако забележите дефект в печата, първата стъпка за констатиране и отстраняване на проблема е пускането на Nozzle Check.
              </p>

              <div class="divider"></div>
              ${youtubeBlock("BQE_Dmytz58", "Видео: Nozzle Check")}

              <div class="divider"></div>
              ${imgBlock("nozzle-check-1.png", "Nozzle Check 1")}
              <div style="height:10px;"></div>
              ${imgBlock("nozzle-check-2.png", "Nozzle Check 2")}
              <div style="height:10px;"></div>
              ${imgBlock("nozzle-check-3.png", "Nozzle Check 3")}
              <div style="height:10px;"></div>
              ${imgBlock("nozzle-check-4.png", "Nozzle Check 4")}
            </div>
          `
        },

        headclean: {
          title: "Почистване на печатащата глава",
          html: `
            <div class="card">
              <p style="margin:0; line-height:1.45;">
                След Nozzle Check, ако виждате липсващи/криви дюзи, може да направите почистване на печатащата глава (Head Cleaning).
              </p>

              <div class="divider"></div>
              ${youtubeBlock("0rtTi9dCe0k", "Видео 1: Head Cleaning")}
              <div style="height:10px;"></div>
              ${youtubeBlock("N5eNZl3W0lU", "Видео 2: Head Cleaning")}

              <div class="divider"></div>
              ${imgBlock("head-cleaning-1.png", "Head Cleaning 1")}
              <div style="height:10px;"></div>
              ${imgBlock("head-cleaning-2.png", "Head Cleaning 2")}
              <div style="height:10px;"></div>
              ${imgBlock("head-cleaning-3.png", "Head Cleaning 3")}
              <div style="height:10px;"></div>
              ${imgBlock("head-cleaning-4.png", "Head Cleaning 4")}
            </div>
          `
        },

        paperload: {
          title: "Правилно поставяне на хартията при печат",
          html: `
            <div class="card">
              <p style="margin:0; line-height:1.45;">
                Уверете се, че правилно поставяте ограничителите на хартията според нейния размер.
              </p>

              <div class="divider"></div>
              <p style="margin:0 0 10px 0;"><b>Видео:</b></p>
              ${youtubeBlock("tWoByPL0NYc", "Видео 1")}
              <div style="height:10px;"></div>
              ${youtubeBlock("XW8OZvhQJ1g", "Видео 2")}
              <div style="height:10px;"></div>
              ${youtubeBlock("Qq6bqjR_QVs", "Видео 3")}
              <div class="divider"></div>
              <p style="margin:0;">
                <a href="https://www.youtube.com/watch?v=VUAirzHDGTs" target="_blank" rel="noreferrer">
                  Видео за печат през право подаване на хартията
                </a>
              </p>
            </div>
          `
        },

        maintank: {
          title: "Подмяна на Maintenance Tank (контейнер за отпадъчно мастило)",
          html: `
            <div class="card">
              <p style="margin:0; line-height:1.45;">
                При печат, мастилото, което попада извън хартията се събира в Maintenance Tank-а.
                При достигане на лимита, принтерът спира да печата, докато контейнерът не бъде сменен.
              </p>

              <div class="divider"></div>
              <p style="margin:0;">
                <a href="https://factor.bg/product/4169/epson-maintenance-box-za-ecotank-l8160-l8180-l8050-l18050-sl-d500.html" target="_blank" rel="noreferrer">
                  FACTOR.BG – Maintenance Box (продукт)
                </a>
              </p>

              <div class="divider"></div>
              ${imgBlock("maintenance-tank-1.png", "Maintenance Tank 1")}
              <div style="height:10px;"></div>
              ${imgBlock("maintenance-tank-2.png", "Maintenance Tank 2")}

              <div class="divider"></div>
              ${youtubeBlock("nuHDsQL7Okc", "Видео: Maintenance Tank")}

              <div class="divider"></div>
              <p style="margin:0;">
                <a href="https://factor.bg/page/46/zayavka-za-remont.html" target="_blank" rel="noreferrer">
                  FACTOR.BG – Заявка за ремонт
                </a>
              </p>
            </div>
          `
        },

        paperjam: {
          title: "Paper Jam грешка и почистване на колелцата за подаване на хартията",
          html: `
            <div class="card">
              <p style="margin:0; line-height:1.45;">
                Препоръчваме да почистите колелцата като следвате инструкциите във видеото.
              </p>

              <p style="margin:14px 0 0 0;">
                <a href="https://www.youtube.com/watch?v=23hXoBAo2gU" target="_blank" rel="noreferrer">
                  Видео за почистване на колелца
                </a>
              </p>

              <div class="divider"></div>
              ${imgBlock("paper-jam-1.png", "Paper Jam 1")}
              <div style="height:10px;"></div>
              ${imgBlock("paper-jam-2.png", "Paper Jam 2")}
              <div style="height:10px;"></div>
              ${imgBlock("paper-jam-3.png", "Paper Jam 3")}
              <div style="height:10px;"></div>
              ${imgBlock("paper-jam-4.png", "Paper Jam 4")}
              <div style="height:10px;"></div>
              ${imgBlock("paper-jam-5.png", "Paper Jam 5")}
              <div style="height:10px;"></div>
              ${imgBlock("paper-jam-6.png", "Paper Jam 6")}
            </div>
          `
        },

        apple: {
          title: "Проблем при принтиране на Apple устройства",
          html: `
            <div class="card">
              <p style="margin:0; line-height:1.45;">
                Възможно е Apple устройството да прехвърли принтера на AirPrint, вместо на драйвера, което няма да позволи печат.
                Това се случва понякога без потвърждение от потребителя, особено ако е имало ъпдейт.
              </p>
              <p style="margin:14px 0 0 0; line-height:1.45;">
                Уверете се, че заявката за печат се подава на правилното място.
              </p>
            </div>
          `
        },

        storage: {
          title: "Правилно съхранение и подготовка на печатната медия",
          html: `
            <div class="card">
              <ul style="margin:0; padding-left:18px; line-height:1.6;">
                <li>Съхранявайте хартията за печат винаги прибрана в пликчето.</li>
                <li>Темперирайте хартията поне 24 часа в помещението с принтера през студения сезон.</li>
              </ul>
            </div>
          `
        },

        printing: {
          title: "Правила при печат, спецификации за матови медии и други",
          html: `
            <div class="card">
              <ul style="margin:0; padding-left:18px; line-height:1.6;">
                <li>При несъответствие на цветовете на разпечатката, изчакайте поне 15–20 мин. и тогава погледнете отново.</li>
                <li>Очаквайте до 1мм. отклонение в позицията на печата спрямо хартията.</li>
                <li>Не печатайте наситени плътни фонове на тънки матови или обикновени хартии, особено Borderless формат.</li>
                <li>При двустранен печат, печатайте първо страната с по-леко насищане, изчакайте да изсъхне и тогава печатайте другата.</li>
              </ul>
            </div>
          `
        }
      };

      // ---------- STATE ----------
      let currentStep = 1;
      const gateNextByChecks = true;

      // ---------- NAV / PAGE ----------
      function showPage(id) {
        document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
        document.getElementById("page-" + id).classList.add("active");
        window.scrollTo(0, 0);
      }

      function go(id) {
        document.getElementById("nav").style.display = (id === "step") ? "block" : "none";
        showPage(id);
      }

      function goStep(n) {
        currentStep = n;
        renderStep();
        document.getElementById("nav").style.display = "block";
        showPage("step");
        updateNextButton();
      }

      function prevStep() {
        if (currentStep <= 1) return go("intro");
        currentStep -= 1;
        renderStep();
        updateNextButton();
        window.scrollTo(0, 0);
      }

      function nextStep() {
        if (gateNextByChecks && isNextDisabled()) return;

        if (currentStep >= 11) return go("resources");
        currentStep += 1;
        renderStep();
        updateNextButton();
        window.scrollTo(0, 0);
      }

      function goArticle(key) {
        document.getElementById("nav").style.display = "none";
        renderArticle(key);
        showPage("article");
      }

      // ---------- RENDER HELPERS ----------
      function escapeHtml(str) {
        return String(str)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      function imgBlock(src, alt) {
        return `
          <img class="card-img" src="${src}" alt="${escapeHtml(alt)}"
               onload="this.nextElementSibling.style.display='none';"
               onerror="this.style.display='none'; this.nextElementSibling.style.display='none';" />
          <div class="muted" style="margin-top:8px;">(Липсва файл: ${escapeHtml(src)})</div>
        `;
      }

      function videoBlock(src, label) {
        return `
          <div class="video">
            <video controls playsinline style="width:100%; display:block;"
                   onloadeddata="this.nextElementSibling.style.display='none';"
                   onerror="this.style.display='none';">
              <source src="${src}" type="video/mp4" />
            </video>
            <div class="video-placeholder">
              ${escapeHtml(label)}<br/>
              <span class="muted">(Липсва файл: ${escapeHtml(src)})</span>
            </div>
          </div>
        `;
      }
      
      function youtubeBlock(videoId, label) {
  return `
    <div class="video">
      <iframe
        src="https://www.youtube-nocookie.com/embed/${videoId}?playsinline=1&rel=0"
        title="${label}"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
        style="width:100%; aspect-ratio:16/9; border-radius:12px;"
      ></iframe>
    </div>
  `;
}


      function noteBlock(kind, text) {
        const icon = kind === "warning" ? "icon-warning.svg" : "icon-tip.svg";
        const prefix = kind === "warning" ? "<b>Внимание:</b> " : "";
        return `
          <div class="note">
            <img src="${icon}" class="note-icon" alt="" />
            <div class="note-text">${prefix}${escapeHtml(text.replace(/^Внимание:\s*/i, ""))}</div>
          </div>
        `;
      }

      function imgsBlock(imgs, stepN) {
        if (!imgs || !imgs.length) return "";
        return imgs
          .map((src, i) => imgBlock(src, `Стъпка ${stepN} – изображение ${i + 1}`))
          .join(`<div style="height:10px;"></div>`);
      }

      // ---------- STEP RENDER ----------
      function renderStep() {
        const s = steps.find(x => x.n === currentStep);
        const root = document.getElementById("step-root");

        if (!s) {
          root.innerHTML = `<p>Липсва стъпка ${currentStep}</p>`;
          return;
        }

        const pct = Math.round((s.n / 11) * 100);

        const checksHtml = (s.checks || []).map((t) => `
          <label class="check">
            <input type="checkbox" data-stepcheck="1" onchange="onChecksChanged()" />
            <span>${escapeHtml(t)}</span>
          </label>
        `).join("");

        if (s.customHtml) {
          root.innerHTML = `
            <h2 class="step-title">${s.n}. ${escapeHtml(s.title)}</h2>
            <div class="progress-row">
              <span>Прогрес</span>
              <span>Стъпка ${s.n} от 11</span>
            </div>
            <div class="bar"><div style="width:${pct}%"></div></div>
            ${s.customHtml}
          `;
          updateNextButton();
          return;
        }

        const imgsHtml = imgsBlock(s.imgs || [], s.n);

        root.innerHTML = `
          <h2 class="step-title">${s.n}. ${escapeHtml(s.title)}</h2>

          <div class="progress-row">
            <span>Прогрес</span>
            <span>Стъпка ${s.n} от 11</span>
          </div>

          <div class="bar"><div style="width:${pct}%"></div></div>

          <div class="card">
            ${imgsHtml}

            ${(s.checks && s.checks.length) ? `<div class="divider"></div>` : ``}
            ${(s.checks && s.checks.length) ? `<div class="checklist">${checksHtml}</div>` : ``}

            ${s.warning ? noteBlock("warning", s.warning) : ""}
            ${s.tip ? noteBlock("tip", s.tip) : ""}
          </div>
        `;

        updateNextButton();
      }

      function onChecksChanged() {
        updateNextButton();
      }

      function isNextDisabled() {
        const s = steps.find(x => x.n === currentStep);
        if (!gateNextByChecks) return false;
        if (!s || !s.checks || s.checks.length === 0) return false;

        const boxes = document.querySelectorAll('input[type="checkbox"][data-stepcheck="1"]');
        if (!boxes.length) return true;
        return !Array.from(boxes).every(b => b.checked);
      }

      function updateNextButton() {
        const nextBtn = document.getElementById("nextBtn");
        nextBtn.textContent = (currentStep >= 11) ? "→ Приключи" : "→ Следваща стъпка";
        nextBtn.disabled = isNextDisabled();
      }

      // ---------- ARTICLE RENDER ----------
      function renderArticle(key) {
        const art = resources[key];
        const root = document.getElementById("article-root");

        if (!art) {
          root.innerHTML = `<p>Липсва ресурс: ${escapeHtml(key)}</p>`;
          return;
        }

        root.innerHTML = `
          <h2 class="step-title" style="margin-top:24px;">${escapeHtml(art.title)}</h2>
          ${art.html}
        `;
      }

      // Start
      go("welcome");
    </script>
  </body>
</html>

